<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Nosto Autocomplete</title>
    <link rel="stylesheet" href="global.css">

    <!-- Include default nosto code -->
    <script>
      (function() {
        var name="nostojs";
        window[name]=window[name]||function(cb){(window[name].q=window[name].q||[]).push(cb);};
       })();
    </script>

    <!-- Include demo merchant with ability to run it locally -->
    <script src="https://connect.nosto.com/include/shopify-9758212174" async onload="setTimeout(function() { window.nosto.reload({site: location.hostname, searchEnabled: false }) }, 100)"></script>
    <script src="../../dist/nosto-autocomplete.umd.js" async onload="setTimeout(function() { window.initAutocomplete() }, 100)"></script>

    <!-- Include browser bundle of react -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <!-- Include browser babel (do not use in production) -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <link rel="stylesheet" href="autocomplete.css">
    <script type="text/babel">
      function Autocomplete({ response }) {
        if (!response.keywords || !response.keywords.hits.length || !response.products || !response.products.hits.length) {
          return null
        }

        return <div>
          {response.keywords && response.keywords.hits.length > 0 && <div>
            <div class="ns-autocomplete-header">
              Keywords
            </div>
              {response.keywords.hits.map((hit) => {
                return <div class="ns-autocomplete-keyword" data-ns-hit="{{ hit | json }}">
                  <span>{ hit.keyword }</span>
                </div>
              })}
            </div>}
            {response.products && response.products.hits.length > 0 && <div>
              <div class="ns-autocomplete-header">
                Products
              </div>
                {response.products.hits.map((hit) => {
                  return <a href={hit.url} data-ns-hit={JSON.stringify(hit)}>
                    { hit.name }
                  </a>
                })}
              </div>}
        </div>
      }

      window.initAutocomplete = function () {
        let reactRoot = undefined

        window.nostoAutocomplete.autocomplete({
          query: {
            products: {
              fields: ['name', 'url', 'imageUrl'],
              size: 5
            },
            keywords: {
              size: 5
            }
          },
          inputSelector: '#search',
          dropdownSelector: '#search-results',
          render: function (container, state) {
            console.log('render')
            if (!reactRoot) {
              reactRoot = ReactDOM.createRoot(container)
            }
            reactRoot.render(<Autocomplete {...state}/>)
          }
        })
      }
    </script>
</head>

  <body>
    <form id="search-form">
      <input type="text" id="search" placeholder="search" />
      <button type="submit" id="search-button">Search</button>
      <div id="search-results" class="ns-autocomplete"></div>
    </form>
  </body>
</html>
